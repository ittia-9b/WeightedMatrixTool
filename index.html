<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weighted Matrix Tool</title>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #007AFF;
            --border-color: #404040;
            --danger-color: #FF453A;
            --success-color: #32D74B;
            --input-bg: #3d3d3d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Matrix Screen Styles */
        #matrixScreen {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .matrix-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 2px;
            margin-bottom: 2rem;
        }

        .matrix-table th, .matrix-table td {
            padding: 1rem;
            text-align: center;
            background: var(--input-bg);
            border-radius: 8px;
        }

        .matrix-table th {
            background: var(--accent-color);
            color: var(--text-primary);
            font-weight: 600;
        }

        .weight-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .weight-control button {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--accent-color);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .weight-control button:hover {
            background: #0056b3;
        }

        .weight-control input,
        .matrix-cell input {
            width: 60px;
            text-align: center;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--input-bg);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        button {
            padding: 0.75rem 1.5rem;
            background: var(--accent-color);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        /* Heatmap Scale */
        .heatmap-scale {
            margin-top: 2rem;
            padding: 1rem;
            background: var(--input-bg);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .scale-header {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scale-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .mode-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--input-bg);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-primary);
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--accent-color);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .scale-container {
            width: 100%;
            max-width: 600px;
            height: 40px;
            display: flex;
            align-items: center;
            position: relative;
        }

        .scale-gradient {
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, 
                rgba(255, 69, 58, 1) 0%,
                rgba(255, 69, 58, 0.5) 20%,
                rgba(255, 255, 255, 0.1) 45%,
                rgba(255, 255, 255, 0.1) 55%,
                rgba(50, 215, 75, 0.5) 80%,
                rgba(50, 215, 75, 1) 100%
            );
            border-radius: 4px;
        }

        .scale-labels {
            width: 100%;
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .scale-title {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .editable-label {
            background: none;
            border: 1px solid transparent;
            color: var(--text-primary);
            font-size: 1rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: text;
            transition: all 0.2s ease;
            width: auto;
            min-width: 60px;
        }

        .editable-label:hover {
            border-color: var(--border-color);
        }

        .editable-label:focus {
            outline: none;
            border-color: var(--accent-color);
            background: var(--input-bg);
        }

        .title-cell {
            background: var(--accent-color) !important;
            font-weight: 600;
        }

        .title-cell .editable-label {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            width: 100%;
            background: none;
        }

        .title-cell .editable-label:focus {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Add these new styles */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .action-buttons button {
            flex: 1;
            min-width: 200px;
        }

        .matrix-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .matrix-controls button {
            flex: 1;
            min-width: 150px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        .matrix-controls button:hover {
            background: var(--input-bg);
        }

        /* Responsive design adjustments */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .matrix-table {
                font-size: 0.9rem;
            }

            .matrix-table th, .matrix-table td {
                padding: 0.5rem;
            }

            .weight-control {
                flex-direction: column;
            }

            .weight-control button {
                width: 24px;
                height: 24px;
            }

            .weight-control input,
            .matrix-cell input {
                width: 50px;
                padding: 0.25rem;
            }

            .action-buttons,
            .matrix-controls {
                flex-direction: column;
            }

            .action-buttons button,
            .matrix-controls button {
                width: 100%;
            }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-color);
            color: var(--text-primary);
            padding: 1rem 2rem;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="matrixScreen">
            <div class="matrix-controls">
                <button onclick="addRow()">Add Row</button>
                <button onclick="removeRow()">Remove Row</button>
                <button onclick="addColumn()">Add Column</button>
                <button onclick="removeColumn()">Remove Column</button>
            </div>
            <div id="matrixContainer"></div>
            
            <!-- Heatmap Scale -->
            <div class="heatmap-scale">
                <div class="scale-header">
                    <div class="scale-title">Weighted Value Scale</div>
                    <div class="scale-mode-toggle">
                        <span class="mode-label">Dynamic Scale</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="scaleToggle" onchange="updateMatrix()" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="scale-container">
                    <div class="scale-gradient"></div>
                </div>
                <div class="scale-labels">
                    <span id="minLabel">Negative Impact (-10)</span>
                    <span>Neutral (0)</span>
                    <span id="maxLabel">Positive Impact (+10)</span>
                </div>
            </div>

            <div class="action-buttons">
                <button onclick="createMatrix()">Start Over</button>
                <button onclick="copyAsMarkdown()">Copy as Markdown</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Initialize the matrix on page load
        document.addEventListener('DOMContentLoaded', () => createMatrix());

        function createMatrix() {
            const defaultTitle = "Weighted Matrix";
            const defaultPrimary = ["P1", "P2", "P3"];
            const defaultSecondary = ["S1", "S2", "S3", "S4"];
            
            // Create matrix table
            const table = document.createElement('table');
            table.className = 'matrix-table';
            
            // Header row with editable labels
            const headerRow = document.createElement('tr');
            
            // Title cell (top-left)
            const titleCell = document.createElement('th');
            titleCell.className = 'title-cell';
            titleCell.innerHTML = `<input type="text" class="editable-label" value="${defaultTitle}">`;
            headerRow.appendChild(titleCell);
            
            // Secondary condition headers
            defaultSecondary.forEach(condition => {
                const th = document.createElement('th');
                th.innerHTML = `<input type="text" class="editable-label" value="${condition}">`;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // Matrix rows
            defaultPrimary.forEach(condition => {
                const row = document.createElement('tr');
                
                // Primary condition cell with weight control
                const primaryCell = document.createElement('td');
                primaryCell.innerHTML = `
                    <div>
                        <div style="margin-bottom: 0.5rem;">
                            <input type="text" class="editable-label" value="${condition}">
                        </div>
                        <div class="weight-control">
                            <button onclick="adjustWeight(this, -1)">-</button>
                            <input type="number" value="1" min="0" max="10" onchange="updateMatrix()">
                            <button onclick="adjustWeight(this, 1)">+</button>
                        </div>
                    </div>
                `;
                row.appendChild(primaryCell);

                // Value cells
                defaultSecondary.forEach(() => {
                    const td = document.createElement('td');
                    td.className = 'matrix-cell';
                    td.innerHTML = `<input type="number" value="0" min="-10" max="10" onchange="updateMatrix()">`;
                    row.appendChild(td);
                });

                table.appendChild(row);
            });

            // Clear and append new matrix
            const matrixContainer = document.getElementById('matrixContainer');
            matrixContainer.innerHTML = '';
            matrixContainer.appendChild(table);

            updateMatrix();
        }

        function adjustWeight(button, change) {
            const input = button.parentElement.querySelector('input');
            const newValue = Math.max(0, Math.min(10, parseInt(input.value) + change));
            input.value = newValue;
            updateMatrix();
        }

        function updateMatrix() {
            const cells = document.querySelectorAll('.matrix-cell input');
            const isDynamicScale = document.getElementById('scaleToggle').checked;
            
            // Calculate min and max weighted values for dynamic scale
            let minWeightedValue = 0;
            let maxWeightedValue = 0;
            let hasNonZeroValues = false;
            
            cells.forEach(cell => {
                const row = cell.closest('tr');
                const weight = parseFloat(row.querySelector('.weight-control input').value);
                const value = parseFloat(cell.value) || 0;
                const weightedValue = value * weight;
                
                if (weightedValue !== 0) {
                    hasNonZeroValues = true;
                    if (minWeightedValue === 0) minWeightedValue = weightedValue;
                    if (maxWeightedValue === 0) maxWeightedValue = weightedValue;
                }
                
                minWeightedValue = Math.min(minWeightedValue, weightedValue);
                maxWeightedValue = Math.max(maxWeightedValue, weightedValue);
            });

            if (!hasNonZeroValues) {
                minWeightedValue = -1;
                maxWeightedValue = 1;
            }

            if (!isDynamicScale) {
                // Fixed scale -10 to +10
                const maxWeight = Math.max(...Array.from(document.querySelectorAll('.weight-control input')).map(input => parseFloat(input.value)));
                minWeightedValue = -10 * maxWeight;
                maxWeightedValue = 10 * maxWeight;
            }

            // Ensure we don't divide by zero
            if (minWeightedValue === 0) minWeightedValue = -1;
            if (maxWeightedValue === 0) maxWeightedValue = 1;

            // Update scale labels
            document.getElementById('minLabel').textContent = `Negative Impact (${minWeightedValue.toFixed(1)})`;
            document.getElementById('maxLabel').textContent = `Positive Impact (+${maxWeightedValue.toFixed(1)})`;

            // Update cell colors
            cells.forEach(cell => {
                const row = cell.closest('tr');
                const weight = parseFloat(row.querySelector('.weight-control input').value);
                const value = parseFloat(cell.value) || 0;
                const weightedValue = value * weight;
                
                let color;
                if (weightedValue < 0) {
                    const intensity = Math.min(Math.abs(weightedValue) / Math.abs(minWeightedValue), 1);
                    color = `rgba(255, 69, 58, ${intensity})`; // iOS-style red
                } else if (weightedValue > 0) {
                    const intensity = Math.min(weightedValue / maxWeightedValue, 1);
                    color = `rgba(50, 215, 75, ${intensity})`; // iOS-style green
                } else {
                    color = 'rgba(255, 255, 255, 0.1)'; // Subtle dark mode neutral
                }
                
                cell.parentElement.style.backgroundColor = color;
            });

            // Update gradient scale
            const scaleGradient = document.querySelector('.scale-gradient');
            const gradientStops = [
                `rgba(255, 69, 58, 1) 0%`,
                `rgba(255, 69, 58, 0.5) 20%`,
                `rgba(255, 255, 255, 0.1) 45%`,
                `rgba(255, 255, 255, 0.1) 55%`,
                `rgba(50, 215, 75, 0.5) 80%`,
                `rgba(50, 215, 75, 1) 100%`
            ].join(',');
            scaleGradient.style.background = `linear-gradient(to right, ${gradientStops})`;
        }

        function addRow() {
            const table = document.querySelector('.matrix-table');
            const newRow = document.createElement('tr');
            const columnCount = table.rows[0].cells.length;
            
            // Primary condition cell with weight control
            const primaryCell = document.createElement('td');
            primaryCell.innerHTML = `
                <div>
                    <div style="margin-bottom: 0.5rem;">
                        <input type="text" class="editable-label" value="P${table.rows.length}">
                    </div>
                    <div class="weight-control">
                        <button onclick="adjustWeight(this, -1)">-</button>
                        <input type="number" value="1" min="0" max="10" onchange="updateMatrix()">
                        <button onclick="adjustWeight(this, 1)">+</button>
                    </div>
                </div>
            `;
            newRow.appendChild(primaryCell);

            // Value cells
            for (let i = 1; i < columnCount; i++) {
                const td = document.createElement('td');
                td.className = 'matrix-cell';
                td.innerHTML = `<input type="number" value="0" min="-10" max="10" onchange="updateMatrix()">`;
                newRow.appendChild(td);
            }

            table.appendChild(newRow);
            updateMatrix();
        }

        function removeRow() {
            const table = document.querySelector('.matrix-table');
            if (table.rows.length > 2) { // Keep at least one row plus header
                table.deleteRow(table.rows.length - 1);
                updateMatrix();
            }
        }

        function addColumn() {
            const table = document.querySelector('.matrix-table');
            
            // Add header
            const headerCell = document.createElement('th');
            headerCell.innerHTML = `<input type="text" class="editable-label" value="S${table.rows[0].cells.length}">`;
            table.rows[0].appendChild(headerCell);

            // Add cells to each row
            for (let i = 1; i < table.rows.length; i++) {
                const td = document.createElement('td');
                td.className = 'matrix-cell';
                td.innerHTML = `<input type="number" value="0" min="-10" max="10" onchange="updateMatrix()">`;
                table.rows[i].appendChild(td);
            }

            updateMatrix();
        }

        function removeColumn() {
            const table = document.querySelector('.matrix-table');
            if (table.rows[0].cells.length > 2) { // Keep at least one column plus primary
                for (let i = 0; i < table.rows.length; i++) {
                    table.rows[i].deleteCell(table.rows[i].cells.length - 1);
                }
                updateMatrix();
            }
        }

        function copyAsMarkdown() {
            const table = document.querySelector('.matrix-table');
            let markdown = [];
            
            // Get headers
            let headers = [];
            const headerRow = table.rows[0];
            for (let i = 0; i < headerRow.cells.length; i++) {
                const input = headerRow.cells[i].querySelector('.editable-label');
                headers.push(input.value);
            }
            markdown.push('| ' + headers.join(' | ') + ' |');
            
            // Add separator
            markdown.push('| ' + headers.map(() => '---').join(' | ') + ' |');
            
            // Get data rows
            for (let i = 1; i < table.rows.length; i++) {
                const row = table.rows[i];
                let rowData = [];
                
                // Primary condition and weight
                const primaryInput = row.cells[0].querySelector('.editable-label');
                const weightInput = row.cells[0].querySelector('.weight-control input');
                rowData.push(`${primaryInput.value} (${weightInput.value})`);
                
                // Values
                for (let j = 1; j < row.cells.length; j++) {
                    const input = row.cells[j].querySelector('input');
                    const value = parseFloat(input.value);
                    const weight = parseFloat(weightInput.value);
                    rowData.push((value * weight).toFixed(1));
                }
                
                markdown.push('| ' + rowData.join(' | ') + ' |');
            }

            // Copy to clipboard
            navigator.clipboard.writeText(markdown.join('\n'))
                .then(() => showToast('Copied to clipboard!'))
                .catch(err => showToast('Failed to copy: ' + err));
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
